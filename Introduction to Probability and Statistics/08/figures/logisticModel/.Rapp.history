library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", 0.2, 0.4, 0.6, 0.8, "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2     ", "0.4     ", "0.6     ", "0.8     ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.6, 0.4, "Locally-estimated\nprobability", pos=4)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.6, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.58, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)))#
#abline(g1)#
lines(p, Y)#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
dev.off()#
#
p  <- p.
?predict.lm
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)
Y
p  <- seq(0, 0.7, length.out=200)
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)
Y
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
rect(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)
lines(p, Y)
p
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
rect(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()#
#
p  <- p.
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
rect(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()#
#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.35, "Locally-estimated\nprobability", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.3, "Locally-estimated\nprobability with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.32, "Locally-estimated\nprobability with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#00000066")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.32, "Locally-estimated\nprobabilities with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.6, 0.4, 0.5, 0.5, length=0.05)#
text(0.59, 0.32, "Locally-estimated\nprobabilities with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.4, 0.6, 0.48, 0.5, length=0.05)#
text(0.59, 0.32, "Locally-estimated\nprobabilities with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.59, 0.32, "Locally-estimated\nprobabilities with\nbounds", pos=4, cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.35, 0.65, "Locally-estimated\nprobabilities with\nbounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.35, 0.6, "Locally-estimated\nprobabilities with\nbounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#00000033", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFFF0033", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#88FF0055", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#CCFF0055", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#CCFF4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
abline(0,1, lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFCC4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,0), c(1,1), lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFCC4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFCC4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
p  <- p.#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFCC4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFDD8855", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFDD4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#FFEE4455", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0EA1755", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81755", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000")#
lines(c(0,1), c(0,1), lty=2, col="#000000AA")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000", lwd=2.5)#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.3, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.1,1.1), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.3, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.7)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.05)#
text(0.28, 0.58, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.4, 0.55, 0.47, 0.51, length=0.07)#
text(0.28, 0.58, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.39, 0.53, 0.47, 0.51, length=0.07)#
text(0.28, 0.58, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.53, 0.47, 0.51, length=0.07)#
text(0.25, 0.58, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.53, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7, 4.5, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
Y
p  <- seq(0, 0.7, length.out=200)
cbind(p, Y$fit)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.74, length=0.07)#
#text()#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.735, 0.735, length=0.07)#
#text()#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.735, 0.75, length=0.07)#
#text()#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
#text()#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.9, 0.45, "What we expect\nif the model\nis reasonable")#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.9, 0.45, "What we expect\nif the model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect\nif the model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect\nif the logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(e$spam - p, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Residual",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
e[1:2,]
hist(e$time)
plot(e$time)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(e$time, e$spam - p, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
X     <- order(e$time)#
plot(X, e$spam - p, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
e[1:2,]
order(e$time)
as.numeric(e$time)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
X     <- order(as.numeric(e$time))#
plot(X, e$spam - p, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
X     <- order(as.numeric(e$time))#
plot(e$time, e$spam - p, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 8))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
g2 <- lm(res ~ ns(e$time, 15))#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 7))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
g2 <- lm(res ~ ns(e$time, 15))#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 6))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
g2 <- lm(res ~ ns(e$time, 15))#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
g2 <- lm(res ~ ns(e$time, 15))#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 10)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
g2 <- lm(res ~ ns(e$time, 10))#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, 5))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, 5)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 6#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 9#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 5#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 12#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#22558818", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Observation index (order of collection)", ylab="Time email was sent",#
     col="#22558855", pch=20)#
axis(1)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
e$time
range(e$time)
range(as.numeric(e$time))
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)
DR
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90*24*3600
Mo
7847458/90
7847458/90/3600
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90*24*3600
Mo
c(0, DR*31, DR*59, DR*90)/90*24*3600
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90
Mo
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, c("Jan", "Feb", "March", "April"))#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4))#
axis(1, (Mo[-1] + Mo[-length(Mo)]+)/2, c("Jan", "Feb", "March", "April"))#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4))#
axis(1, (Mo[-1] + Mo[-length(Mo)]+)/2, c("Jan", "Feb", "March"))#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4))#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("Jan", "Feb", "March"))#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4))#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("Jan", "Feb", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4))#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.2)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.5)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 9#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 8#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 5#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 6#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 10#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 12#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 6#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.47, 0.51, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.8, 0.54, 0.75, 0.735, length=0.07)#
text(0.85, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.54, 0.78, 0.735, length=0.07)#
text(0.88, 0.45, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.53, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.7, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, 10))#
p    <- seq(0, 0.7, length.out=200)#
Y    <- predict(g1, data.frame(ns(Time, 10)), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
any(p > 0.75)
max(p)
hist(p)
hist(p.)
max(p.)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.
ns2 <- 10
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], lengt.out=200)
ns2
Time
Time <- seq(TR[1], TR[2], length.out=200)
Time
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)
p
Y$fit
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
lines(p, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
p
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
lines(Time, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.05)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.05)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.05)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
dev.off()
Mo
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.05)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.05)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 7 mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 7, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 7, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 7, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#22558838", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#4488AA38", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#345D8738", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
hex2base10
?hex
3*16 + 3 -> r
g <- 5*16 + 5
b <- 8*16 + 8
b/255
g/255
r/255
1 - .46666*.6
1 - (1-b/255)*.6
(1 - (1-b/255)*.6)*16
(1 - (1-g/255)*.6)*16
(1 - (1-r/255)*.6)*16
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#859AB838", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#859AB855", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
(1 - (1-r/255)*.7)*16
(1 - (1-g/255)*.7)*16
g <- 5*16 + 5
(1 - (1-g/255)*.7)*16
(1 - (1-b/255)*.7)*16
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#7188AB55", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
g <- 5*16 + 5
(1 - (1-b/255)*.8)*16
(1 - (1-g/255)*.8)*16
(1 - (1-r/255)*.8)*16
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81766", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
lines(p, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81766", border="#00000000")#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
lines(Time, Y$fit, lwd=2.5)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81788", border="#00000000")#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81788", border="#00000000")#
lines(Time, Y$fit, lwd=2.5)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E81788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E81788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 5.6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 5.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.5, mar=c(3.9, 5.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 5.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.5, 4.8, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
max(p)
library(openintro)#
library(splines)
?ns
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1, seq(0, 0.75, length.out=ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1, seq(0, 0.75, length.out=ns1))), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
g1 <- lm(e$spam ~ ns(p, ns1, seq(0, 0.75, length.out=ns1))
)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1, seq(0, 0.75, length.out=ns1)))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1, seq(0, 0.75, length.out=ns1)))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1, seq(0, 0.75, length.out=ns1))), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000AA")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000AA")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.52, length=0.07)#
text(0.6, 0.25, "Band becomes wide\nbecause there is not much\ndata this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.57, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.52, length=0.07)#
text(0.6, 0.25, "Band becomes wide\nbecause there is not much\ndata this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "Band becomes wide\nbecause there is not much\ndata this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07, col="#000000CC")#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75, col="#000000CC")#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317AA", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E31788", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.78, 0.765, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
acf(res)
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.85, 0.835, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, 0.75, length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 5.4, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="Truth")#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
mtext("Truth", 2, 5.5)#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col="#22558844", pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border="#00000066", col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col="#000000AA", lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col="#33669918", pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=COL[1,4], pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col="#E0E317A0", border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=COL[1,4], pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col="#5B78A055", pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=COL[1,4], pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause there is not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause not much\ndata is found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The band becomes wide\nbecause not much data\nis found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The bounds become wide\nbecause not much data\nis found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro); ?email # run example
library(openintro); ?email # run example
data(email)#
e <- email#
#
#______ Variables For Logistic Regression ______##
# Variables are modified to match#
#   OpenIntro Statistics, Second Edition#
# As Is (7): spam, to_multiple, winner, format,#
#            re_subj, exclaim_subj#
# Omitted (6): from, sent_email, time, image,#
#              viagra, urgent_subj, number#
# Become Indicators (5): cc, attach, dollar,#
#                        inherit, password#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
# Transform (3): num_char, line_breaks, exclaim_mess#
#e$num_char     <- cut(email$num_char, c(0, 1, 5, 10, 20, 1000))#
#e$line_breaks  <- cut(email$line_breaks, c(0, 10, 100, 500, 10000))#
#e$exclaim_mess <- cut(email$exclaim_mess, c(-1, 0, 1, 5, 10000))#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                cc + attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)
summary(g)
library(xtable)
g <- glm(spam ~ to_multiple + winner + format + re_subj + attach + password, data=e, family=binomial); xtable(g)
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.57, length=0.07)#
text(0.6, 0.25, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.62, length=0.07)#
text(0.6, 0.25, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.34, 0.7, 0.61, length=0.07)#
text(0.6, 0.25, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.38, 0.7, 0.61, length=0.07)#
text(0.6, 0.29, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
library(openintro)#
data(COL)#
library(splines)#
data(email)#
e <- email#
e$cc       <- ifelse(email$cc > 0, 1, 0)#
e$attach   <- ifelse(email$attach > 0, 1, 0)#
e$dollar   <- ifelse(email$dollar > 0, 1, 0)#
e$inherit  <- ifelse(email$inherit > 0, 1, 0)#
e$password <- ifelse(email$password > 0, 1, 0)#
g <- glm(spam ~ to_multiple + winner + format + #
                re_subj + exclaim_subj +#
                attach + dollar +#
                inherit + password, # +#
                #num_char + line_breaks + exclaim_mess,#
                data=e, family=binomial)#
summary(g)#
p  <- predict(g, type="response")#
p. <- p#
#
set.seed(1)#
myPDF("logisticModelPredict.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
noise <- rnorm(nrow(e), sd=0.08)#
plot(p, e$spam+noise,#
     xlim=0:1, ylim=c(-0.5,1.5), axes=FALSE,#
     xlab="Predicted probability", ylab="",#
     col=fadeColor(COL[1], "22"), pch=20)#
axis(1)#
axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
dev.off()#
ns1 <- 7#
myPDF("logisticModelSpline.pdf", 7.7, 4.9, mar=c(3.9, 6.6, 0.5, 0.2), mgp=c(2.4, 0.55, 0))#
plot(p, e$spam+noise/5, type="n",#
     xlim=0:1, ylim=c(-0.07,1.07), axes=FALSE,#
     xlab="Predicted probability", ylab="")#
par(las=0)#
mtext("Truth", 2, 5.5)#
par(las=1)#
rect(0,0,1,1, border=COL[6], col="#00000000", lwd=1.5)#
lines(c(0,1), c(0,1), lty=2, col=COL[6], lwd=1.5)#
arrows(0.83, 0.57, 0.8, 0.785, length=0.07)#
text(0.88, 0.48, "What we expect if\nthe logistic model\nis reasonable", cex=0.75)#
points(p, e$spam+noise/5, col=fadeColor(COL[1], "18"), pch=20)#
axis(1)#
axis(2, at=c(0,0.2,0.4,0.6,0.8,1), labels=c("0 (not spam)", "0.2  ", "0.4  ", "0.6  ", "0.8  ", "1 (spam)"))#
g1 <- lm(e$spam ~ ns(p, ns1))#
p  <- seq(0, max(p), length.out=200)#
Y  <- predict(g1, data.frame(ns(p, ns1)), se.fit=TRUE)#
#abline(g1)#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(p, rev(p)), c(yb, yt), col=COL[3,3], border="#00000000")#
lines(p, Y$fit, lwd=2.5)#
arrows(0.36, 0.54, 0.45, 0.52, length=0.07)#
text(0.25, 0.6, "Locally-estimated\nprobabilities with\nconfidence bounds", cex=0.75)#
arrows(0.6, 0.36, 0.7, 0.61, length=0.07)#
text(0.6, 0.27, "The bounds become wide\nbecause not much data\nare found this far right", cex=0.75)#
dev.off()#
p  <- p.#
# _________________________________________________________________#
##
# The Timing Below Isn't Precisely Correct, But It Is Close#
# _________________________________________________________________#
ns2 <- 10#
myPDF("logisticModelResidual.pdf", 8, 6, mar=c(4.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0), mfrow=2:1)#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
plot(e$time, res, axes=FALSE,#
     xlab="Time email was sent", ylab="Residual",#
     col=COL[1,4], pch=20)#
TR  <- range(as.numeric(e$time))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*31, DR*59, DR*90)/90#
axis(1, Mo, rep("", 4), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, c("January", "February", "March"), tcl=0)#
axis(2)#
Time <- e$time#
g2   <- lm(res ~ ns(Time, ns2))#
Time <- seq(TR[1], TR[2], length.out=200)#
Y    <- predict(g2, ns(Time, ns2), se.fit=TRUE)#
abline(h=0, lty=2, col="#00000088")#
yb <- Y$fit - 1.96*Y$se.fit#
yt <- rev(Y$fit + 1.96*Y$se.fit)#
polygon(c(Time, rev(Time)), c(yb, yt), col="#E0E317B5", border="#00000000")#
lines(Time, Y$fit, lwd=1.75)#
#axis(2, at=c(0,1), labels=c("0 (not spam)", "1 (spam)"))#
#dev.off()#
ns2 <- 10#
#myPDF("logisticModelResidual.pdf", 8, mar=c(3.9, 6, 0.5, 0.5), mgp=c(2.4, 0.55, 0))#
par(mar=c(3.9, 6, 1.5, 0.5))#
noise <- rnorm(nrow(e), sd=0.08)#
res   <- e$spam - p#
TR  <- range(as.numeric(e$time))#
plot(e$time, res, axes=FALSE,#
     xlab="January", ylab="Residual",#
     col="#22558855", pch=20, xlim=c(TR[1], quantile(TR, 0.08)))#
DR  <- diff(TR)#
Mo  <- TR[1] + c(0, DR*1:10)/90#
axis(1, Mo, rep("", 11), tcl=-0.7)#
axis(1, (Mo[-1] + Mo[-length(Mo)])/2, 1:10, tcl=0)#
axis(2)#
dev.off()
